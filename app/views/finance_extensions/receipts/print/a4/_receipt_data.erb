<% if has_particulars?(transaction_hash) %>
    <%#= transaction_hash.particulars_list.inspect %>
    <div class="subsection">
      <hr class="light_hor_line"/>
      <div id="sub_text_left"><%= t('particular') %></div>
      <div id="sub_text_right" class=""><%= t('amount') %> (<%= transaction_hash.currency %>)</div>
      <hr class="light_hor_line"/>
      <div class="extender"></div>
    </div>
<% end %>
<% if transaction_hash.is_particular_wise != true %>
    <% if transaction_hash.fee_particulars.present? %>
        <div class="subsection">
          <div class="light_hor_line"></div>
          <div id="sub_text_left"><%= t('particulars') %></div>
          <div id="sub_text_right"><%= t('amount') %> (<%= transaction_hash.currency %>)</div>
          <div class="light_hor_line"></div>
          <div class="extender"></div>
        </div>
        <% transaction_hash.fee_particulars.each_with_index do |particular, i| %>
            <div class="particulars_list">
              <div class="slno"><%= i+1 %>.</div>
              <div class="particalar_name"><%= particular.name %></div>
              <div class="particalar_amount"><%= particular.amount %></div>
            </div>
        <% end %>
    <% end %>

    <% if (transaction_hash.total_discount.to_f).to_f > 0.0 %>
        <div class="subsection">
          <hr class="light_hor_line"/>
          <div id="sub_text_left"><%= t('discount') %></div>
          <div id="sub_text_right"><%= t('amount') %> (<%= transaction_hash.currency %>)</div>
          <hr class="light_hor_line"/>
          <div class="extender"></div>
        </div>

        <% transaction_hash.discounts.each_with_index do |d, i| %>
            <div class="particulars_list">
              <div class="slno"><%= i+1 %>.</div>
              <div class="particalar_name"><%= d.discount_text || d.name %></div>
              <div class="particalar_amount"><%= d.discount_amount %></div>
            </div>
        <% end %>
    <% end %>

    <% if has_tax?(transaction_hash) %>
        <% if transaction_hash.tax_slab_collections.present? %>
            <div class="subsection">
              <div class="light_hor_line"></div>
              <div id="sub_text_left"><%= t('tax_text') %></div>
              <div id="sub_text_right"><%= t('amount') %> (<%= transaction_hash.currency %>)</div>
              <div class="light_hor_line"></div>
              <div class="extender"></div>
            </div>

            <% i = 0 %>
            <% transaction_hash.tax_slab_collections.each_pair do |slab_id, slab| %>
                <div class="particalars_list_item">
                  <div class="slno"><%= i+=1 %>.</div>
                  <div class="particalar_name"><%= slab.display_name %></div>
                  <div class="particalar_amount">
                    <%= FedenaPrecision.set_and_modify_precision(slab.tax_amount.sum.to_f,
                                                                 transaction_hash.precision) %>
                  </div>
                </div>
            <% end %>
        <% end %>
    <% end %>

    <% if transaction_hash.fine_list.present? and transaction_hash.fine_amount.to_f > 0.0 %>
        <div class="subsection">
          <hr class="light_hor_line"/>
          <div id="sub_text_left"><%= t('fine') %></div>
          <div id="sub_text_right"><%= t('amount') %> (<%= transaction_hash.currency %>)</div>
          <hr class="light_hor_line"/>
          <div class="extender"></div>
        </div>
        <% transaction_hash.fine_list.each_with_index do |fine, i| %>
            <div class="particulars_list">
              <div class="slno"><%= i+=1 %>.</div>
              <div class="particalar_name rtl_bracket_fix"><%= fine.name %></div>
              <div class="particalar_amount"><%= (fine.amount) %></div>
            </div>
        <% end %>
    <% end %>

<% else %>
    <% transaction_hash.fee_particulars.each_with_index do |particular, index| %>
        <div class="particular_wise_item">
          <div class="slno"><%= index+1 %>.</div>
          <div class="particalar_name"><%= particular.name %></div>
          <div class="right_total addl_5_margin">
            <div class="right_total_label"><%= t('actual_amount') %></div>
            <div class="right_total_amount"><%= particular.amount %></div>

            <% unless transaction_hash.finance_type == 'InstantFee' %>
                <div class="right_total_label"><%= t('remaining_balance') %></div>
                <div class="right_total_amount"><%= particular.remaining_balance %></div>
            <% end %>

            <% if particular_has_discount(particular) %>
                <div class="right_total_label"><%= t('discount') %></div>
                <div class="right_total_amount"><%= particular.discount %></div>
            <% end %>

            <% if transaction_hash.finance_type == 'InstantFee' and transaction_hash.tax_enabled %>
                <div class="right_total_label"><%= t('tax_text') %></div>
                <div class="right_total_amount"><%= particular.tax_amount %></div>
            <% end %>

            <div class="right_total_label"><%= t('amount_paid') %></div>
            <div class="right_total_amount"><%= particular.amount_paid %> </div>

            <% unless transaction_hash.finance_type == 'InstantFee' %>
                <div class="right_total_label"><%= t('balance') %></div>
                <div class="right_total_amount"><%= particular.balance %></div>
            <% end %>
          </div>
        </div>
    <% end %>

    <% if transaction_hash.fine_list.present? %>
        <div class="subsection">
          <hr class="light_hor_line"/>
          <div id="sub_text_left"><%= t('fine') %></div>
          <div id="sub_text_right"><%= t('amount') %> (<%= transaction_hash.currency %>)</div>
          <hr class="light_hor_line"/>
          <div class="extender"></div>
        </div>
        <% transaction_hash.fine_list.each_with_index do |fine, i| %>
            <div class="particulars_list">
              <div class="slno"><%= i += 1 %>.</div>
              <div class="particalar_name"><%= fine.name %></div>
              <div class="particalar_amount"><%= fine.amount %></div>
            </div>
        <% end %>
    <% end %>

<% end %>

<!-- wallet mode only -->
<% if transaction_hash.wallet_mode_only.present? %>
  <% total_amount_paid = 0.00 %>
  <div class="subsection">
    <div class="light_hor_line"></div>
    <div id="sub_text_left"><%= t('advance_fee_categories_text') %></div>
    <div id="sub_text_right"><%= t('amount') %> (<%= transaction_hash.default_configs.currency_symbol %>)</div>
    <div class="light_hor_line"></div>
    <div class="extender"></div>
  </div>
  <% transaction_hash.transactions.each_with_index do |p, i| %>
      <div class="particulars_list">
        <div class="slno"><%= i+1 %>.</div>
        <div class="particalar_name"><%= p.advance_fee_category.name %></div>
        <div class="particalar_amount"><%= p.fees_paid.to_f %></div>
        <%# total_amount_paid = total_amount_paid.to_f + p.fees_paid.to_f %>
      </div>
  <% end %>
<% end %>

<!-- summary -->
<div class="summary">
  <div class="subsection summary-line">
    <hr class="light_hor_line"/>
    <div id="sub_text_left"><%= t('summary') %></div>
    <div id="sub_text_right"><%= t('amount') %> (<%= transaction_hash.wallet_mode_only.present? ? transaction_hash.default_configs.currency : transaction_hash.currency %>)</div>
    <hr class="light_hor_line"/>
    <div class="extender"></div>
  </div>

  <% i=0 %>

  <div class="particulars_list">
    <div class="slno"><%= i += 1 %>.</div>
    <div class="particalar_name"><%= "#{t('total')} #{t('fees_text')}" %></div>
    <% if transaction_hash.wallet_mode_only.present? %>
      <div class="particalar_amount"><%= transaction_hash.total_payable %></div>
    <% else %>
      <div class="particalar_amount"><%= transaction_hash.total_payable %></div>
    <% end %>
  </div>

  <% if has_discount?(transaction_hash) %>
      <div class="particulars_list">
        <div class="slno"><%= i += 1 %>.</div>
        <div class="particalar_name"><%= "#{t('total')} #{t('discount')}" %></div>
        <div class="particalar_amount"><%= (transaction_hash.total_discount.to_f) %></div>
      </div>
  <% end %>

  <% if has_tax?(transaction_hash) %> <!-- or transaction_hash.collection.tax_enabled or transaction_hash.total_tax.to_f > 0 %> -->
      <div class="particalars_list_item">
        <div class="slno"><%= i += 1 %>.</div>
        <div class="particalar_name"><%= "#{t('total')} #{t('tax_text')}" %></div>
        <div class="particalar_amount"><%= (transaction_hash.total_tax.to_f) %></div>
      </div>
  <% end %>

  <% if has_fine?(transaction_hash) %>
      <div class="particulars_list">
        <div class="slno"><%= i += 1 %>.</div>
        <div class="particalar_name"><%= "#{t('total_fine_amount')}" %></div>
        <div class="particalar_amount"><%= transaction_hash.total_fine_amount %></div>
      </div>
  <% end %>

</div>

<div class="receipt-footer-bottom">
  <div class="left_info">
    <div class="left_info_label"><%= t('payment_mode') %></div>
    <div class="left_info_value"><%= transaction_hash.payment_mode %></div>

    <% if transaction_hash.reference_no.present? %>
        <div class="left_info_label"><%= transaction_hash.reference_label %></div>
        <div class="left_info_value"><%= transaction_hash.reference_no %></div>
    <% end %>

    <% if transaction_hash.payment_mode == "Cheque" %>
        <div class="left_info_label"><%= t('cheque_date') %></div>
        <div class="left_info_value">
          <%= transaction_hash.cheque_date.present? ? transaction_hash.cheque_date : '-' %>
        </div>
        <div class="left_info_label"><%= t('bank_name') %></div>
        <div class="left_info_value">
          <%= transaction_hash.bank_name..present? ? transaction_hash.bank_name : '-' %>
        </div>
    <% end %>

    <% if transaction_hash.payment_note.present? %>
        <div class="left_info_label"><%= t('notes') %></div>
        <div class="left_info_value"><%= transaction_hash.payment_note %></div>
    <% end %>

    <% if has_tax?(transaction_hash) %>
        <div class="left_info_label"><%= transaction_hash.default_configs.finance_tax_identification_label %></div>
        <div class="left_info_value"><%= transaction_hash.default_configs.finance_tax_identification_number %></div>
    <% end %>
  </div>
  <div class="right_total">
    <% unless transaction_hash.finance_type == 'InstantFee' %>
        <div class="right_total_label"><%= t('total_amount_to_pay') %></div>
        <div class="right_total_amount"><%= (transaction_hash.total_amount_to_pay) %></div>

        <% if has_previously_paid_fees?(transaction_hash) %>
            <div class="right_total_label"><%= t('previous_payments') %></div>
            <div class="right_total_amount"><%= (transaction_hash.done_amount || transaction_hash.previously_paid_amount) %></div>
        <% end %>

    <% end %>

    <% if transaction_hash.wallet_mode_only.present? %>
        <div class="right_total_label"><%= t('total_amount_paid') %></div>
        <div class="right_total_amount"><%= (transaction_hash.total_amount_paid.to_f) %></div>
    <% elsif has_previously_paid_fees?(transaction_hash) %>
        <div class="right_total_label"><%= t('total_amount_paid') %></div>
        <div class="right_total_amount"><%= (transaction_hash.total_amount_paid.to_f) %></div>
    <% end %>

    <% unless transaction_hash.finance_type == 'InstantFee' %>
        <% if has_due?(transaction_hash) %>
            <div class="right_total_label"><%= t('total_due_amount') %></div>
            <div class="right_total_amount"><%= (transaction_hash.total_due_amount.to_f) %></div>
        <% end %>
    <% end %>
    <% if transaction_hash.wallet_amount_applied %>
      <b>
          <div class="right_total_label"><%= t('wallet_amount_applied') %></div>
          <div class="right_total_amount"><%= transaction_hash.wallet_amount %></div>
      </b>
    <% end %>
  </div>
</div>

<div class="receipt-footer-bottom words_bottom">
  <% show_amount_in_words = (transaction_hash.default_configs.pdf_receipt_atow.to_i == 1) %>
  <div class="left_info amount_margin">
    <% if show_amount_in_words %>
        <span style="font-weight: bold;"><%= t('amount_in_words') %></span> :
        <%= NumberToWord.convert((transaction_hash.amount.to_f),
                                 transaction_hash.default_configs.pdf_receipt_nsystem,
                                 transaction_hash.default_configs.default_currency) %>
        <br/>
    <% end %>
    <% if transaction_hash.invoice_no.present? %>
        <% if transaction_hash.invoice_enabled %>
            <span style="font-weight: bold;"> <%= t('payment_for_invoice') %></span> :
            <%= transaction_hash.invoice_no %>
        <% end %>
    <% end %>
  </div>
  <div class="right_total">
    <div class="right_total_label"><%= t('amount_paid') %></div>
    <div class="right_total_amount"><%= (transaction_hash.amount.to_f) %></div>
  </div>
</div>
