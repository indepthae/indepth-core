<div id="particulars-list">
    <% student_discount_link=false %>
    <% @categorized_discounts.each do |discount_type| %>
      <tr class="tr-blank"></tr>
      <tr class="tr-<%= cycle("odd", "even") %> <%= discount_type.first %>head" cellpadding="1" cellspacing="1">
          <td class="col-1"></td>
          <td class="col-1 bold_font" colspan="2">
              <span><%= "#{t(discount_type.first.underscore+"_text").titleize}-#{t('wise')}" %></span>
          </td>
      </tr>
      <% discount_type.last.each do |fee| %>
        <tr class="tr-<%= cycle("odd", "even") %> particular" id="particular<%= fee.id %>">
            <td class="col-1 normal_font particular_index"><%= i+=1 %></td>
            <% discount_text = fee.is_amount == true ? "#{fee.name}" : "#{fee.name}-#{fee.discount}% " %>

            <% if fee.master_receiver_type=='FinanceFeeParticular' %>
              <% particular=fee.master_receiver %>
              <td class="col-2 normal_font"><%= "#{discount_text}  &#x200E;(#{particular.name}) &#x200E;" %></td>
              <td class="col-6 normal_font"> 
                  <% discount_amount = precision_label(particular.amount * fee.discount.to_f / (fee.is_amount? ? particular.amount : 100)) %>
                  <% @total_fees -= discount_amount.to_f %>
                  <%= discount_amount %>
              </td>
            <% else %>
              <td class="col-2 normal_font"><%= discount_text %></td>
              <td class="col-6 normal_font">
                  <% discount_amount = precision_label(@total_payable * fee.discount.to_f / (fee.is_amount? ? @total_payable : 100)) %>
                  <% @total_fees -= discount_amount.to_f %>
                  <%= discount_amount %>
              </td>
            <% end %>

            <td class="cancel-disc cancel-color">
                <% if !fee.multi_fee_discount.present? and discount_type.first=='Student' and fee.is_instant and 
                    (@financefee.balance.to_f > 0 )%>
                  <div class="particular-or-discount-deletion" id="<%= fee.id %>" 
                       finance_id="<%= @financefee.id %>" render_action="<%= @target_action %>" 
                       render_controller="<%= @target_controller %>" target_action="delete_student_discount">
                    <% if can_access_request? :delete_student_discount, :finance_extensions %>
                           <%= ("&times") %>
                      <% end %>
                  </div>      
                <% end %>
            </td>
        </tr>
      <% end %>
      <% if (can_access_request? :new_instant_discount,@current_user, :context=> :fees_submission_without_discount) %>
      <% unless @payer_type.present? and @payer_type=="Archived Student" %>
        <% if discount_type.first == 'Student' and (@financefee.balance.to_f > 0 ) %>
          <% student_discount_link = true %>
          <tr>
              <td colspan="3" style="width:100%">
                  <% unless @particular_wise_paid %>
                    <div class="instant-particular">
                        <%= link_to_remote '+ Add Discount', :url => {:controller => "finance_extensions", 
                          :action => "new_instant_discount", :id => @financefee.id, :current_action => @target_action, 
                          :current_controller =>@target_controller} %>
                    </div>
                  <% end %>
              </td>
          </tr>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
</div>

<% unless @payer_type.present? and @payer_type=="Archived Student" %>
  <% if !student_discount_link and (@financefee.balance.to_f > 0)  %>
    <tr>
        <td colspan="3" style="width:100%">
            <% unless @particular_wise_paid %>
              <div class="instant-particular">
                  <%= link_to_remote '+ Add Discount', :url => {:controller => "finance_extensions", 
                    :action => "new_instant_discount", :id => @financefee.id, :current_action => @target_action, 
                    :current_controller => @target_controller, :particular_payment => true} %>
              </div>
            <% end %>
        </td>
    </tr>
  <% end %>
<% end %>

<tr class="tr-blank"></tr>

