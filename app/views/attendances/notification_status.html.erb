<%-# Fedena
#Copyright 2010 Foradian Technologies Private Limited
#
#This product includes software developed at
#Project Fedena - http://www.projectfedena.org/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>
<%# @javascript_for_page = ['attendance','date'] %>
<%  content_for :head do%>
  <% if @config.config_value == 'Daily' %>
    <%= javascript_include_tag 'attendance', 'date' %>
  <% else %>
    <%= javascript_include_tag 'subject_leave', 'date' %>
  <% end %>
  <!--[if IE]>
  <style>

  .present{
    color:#fff;
    padding:5px;
    background:#FFF;
  }
  .td-mark, .td-name{
    background:#FFF;
  }

  </style>
  <![endif]-->
<%  end %>
<div id="content-header">
    <%= show_header_icon %>
    <h1><%= t('notification_status') %></h1>
    <div class='header-sep'>|</div>
    <div class='sub-header'><%= t('notification_status') %></div>


</div>
<div id="page-yield">
    <div class="bread_crumb">
        <%= make_breadcrumb %>
        <%= render_breadcrumbs  %>
    </div>
    <% if @assigned_package.present? %>
      <% if @available_sms <= 0 %>
        <p class="flash-msg"> <%= t('attendances.no_available_sms_count') %></p>
      <% end %>
    <%else%>
      <p class="flash-msg"> <%= t('attendances.no_available_sms') %></p>
    <% end %>
    <% if @config.config_value == 'Daily' %>
      <% remote_form_for :absentees,  :url => {:action => 'notification_status'} do |x| %>   
              
        <div class="grades">
            <div class="label-field-pair">
                <label for="model_names"><%= t('select_batches') %>:</label>
            </div>
            <div class="fee_category_scroll">          
                <div class="sel-list">
                    <%= check_box :select_batch, :all , :class=>'check_box select_all', :onclick => "select_all(this)" %><label><%= t('select_all_batches') %></label>
                </div>
                <% @batches.each do |batch| %>
                  <div class="each_batch">
                      <%= check_box_tag "batch_ids[]" , batch.id,false, :class=>'check_box batch_check', :onclick=>'count_selected_batches(this)' %><label for="configuration_<%= batch.complete_name.humanize %>"><%= batch.full_name %></label>
                  </div>
                <% end %>
            </div>
        </div>

        <div class="label-field-pair absent_date">
            <label>
                <%= t('attendances.select_date') %>:
            </label>
            <div class="text-input-bg">
                <%= calendar_date_select_tag 'date', I18n.l(@absent_date  || FedenaTimeSet.current_time_to_local_time(Time.now).to_date,:format=>:default)%>
            </div>
        </div> 

        <%= submit_tag "", :value => "#{t('attendances.show_absentees')}", :class => "submit_button" %>
      <%end%>
    <% else %>
      <% remote_form_for :absentees,  :url => {:action => 'notification_status'} do |x| %>  

        <div class="label-field-pair absent_date">
            <label>
                <%= t('select_date') %>:
            </label>
            <div class="text-input-bg">
                <%= calendar_date_select_tag 'date', I18n.l(@absent_date  || FedenaTimeSet.current_time_to_local_time(Time.now).to_date,:format=>:default)%>
            </div>
        </div>

        <div class="label-field-pair absent_date">
            <label>
                <%= t('select_a_batch') %>:
            </label>
            <div class="text-input-bg">
                <%= select :batch, :id,
                  @batches.map {|b| [b.full_name, b.id] },
                  {:prompt => "#{t('select_a_batch')}"},
                  {:onchange => "#{remote_function(
                  :url => { :action => 'list_subjects' },
                  :with => "'batch_id='+value",
                  :before => "Element.show('loader')",
                  :success => "Element.hide('loader')"  )}"} %>
            </div>
        </div> 

        <div class="grades" id="list-subjects"></div> 

        <%= submit_tag "", :value => "#{t('show_absentees')}", :class => "submit_button" %>
      <%end%>

    <% end %>

    <%= image_tag("loader.gif", :align => "absmiddle", :border => 0, :id => "loader", :style =>"display: none;margin-top: 10px;" ) %>

    <%= hidden_field_tag 'time_zone_date',@date_today, :id=>'time_zone' %>

    <div id="error_messages"></div>
    <div id="flash-div"></div>
    <div id="table_view"></div>
</div>
<script type="text/javascript">
  function select_all(obj) {
      if (j(obj).prop('checked')) {
          j('.batch_check').prop('checked', true);
      }
      else {

          console.log("select_all deleted");
          j('.batch_check').prop('checked', false);
      }
      count_selected_batches(obj);
  }
  function count_selected_batches(obj) {
      j('.select_all').prop('checked', j('.batch_check:checked').length == j('.batch_check').length);
  }


  function select_all_to_sms(obj) {
      if (j(obj).prop('checked')) {
          j('.student_check').prop('checked', true);
      }
      else {

          console.log("select_all deleted");
          j('.student_check').prop('checked', false);
      }
      count_selected_students(obj);
  }
  function count_selected_students(obj) {
      j('.select_all_sms').prop('checked', j('.student_check:checked').length == j('.student_check').length);
      j('#selected_students').text(j('.student_check:checked').length);
      if (j('.student_check:checked').length > 0) {
          j('#submit-btn-div').show();
      }
      else {
          j('#submit-btn-div').hide();
      }
  }
  function select_all_subjects(obj) {
      if (j(obj).prop('checked')) {
          j('.subject_check').prop('checked', true);
      }
      else {

          console.log("select_all_subjects deleted");
          j('.subject_check').prop('checked', false);
      }
      count_selected_subjects(obj);
  }
  function count_selected_subjects(obj) {
      j('.select_all_subjects').prop('checked', j('.subject_check:checked').length == j('.subject_check').length);
  }
  function disable_link(obj) {
      j(obj).html("<%= t('please_wait') %>");
      j(obj).attr("onclick", "return false;");
  }
  ;
</script>