<%-# Fedena
#Copyright 2010 Foradian Technologies Private Limited
#
#This product includes software developed at
#Project Fedena - http://www.projectfedena.org/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>
<%# @javascript_for_page = ['attendance','date'] %>
<%  content_for :head do%>
  <%= javascript_include_tag 'jquery/jquary-11.js' %> 
  <%= javascript_include_tag 'jquery/MonthPicker.min.js' %> 
  <% if @config.config_value == 'Daily' %>
    <%= javascript_include_tag 'attendance', 'date' %>
  <% else %>
    <%= javascript_include_tag 'subject_leave', 'date' %>
  <% end %>
  <!--[if IE]>
  <style>

  .present{
    color:#fff;
    padding:5px;
    background:#FFF;
  }
  .td-mark, .td-name{
    background:#FFF;
  }

  </style>
  <![endif]-->
<%  end %>
<%  if (rtl?) %>
  <%= stylesheet_link_tag 'rtl/jquery-ui-attendance.css' %>
  <% if @config.config_value == 'Daily' %>
  <%= stylesheet_link_tag 'rtl/DailyMonthPicker.min.css' %>
  <% else %>
  <%= stylesheet_link_tag 'rtl/MonthPicker.min.css' %>
  <% end %>
<% else %>
  <%= stylesheet_link_tag 'jquery-ui-attendance.css' %>
  <% if @config.config_value == 'Daily' %>
   <%= stylesheet_link_tag 'DailyMonthPicker.min.css' %>
  <% else %>
    <%= stylesheet_link_tag 'MonthPicker.min.css' %>
  <% end %>
<% end %>
<div id="content-header">
    <%= show_header_icon %>
    <h1><%= t('attendance_register') %></h1>
    <div class='header-sep'>|</div>
    <div class='sub-header'><%= t('attendance_register') %></div>
    <% sms_setting = SmsSetting.new() %>
    <% settings = SmsSetting.get_settings_for("AttendanceEnabled") %>
    <% if  sms_setting.application_sms_active == true and  (settings["Student"] == true or settings["Guardian"] == true) %>
      <div id="inner-tab-menu">
          <ul>  
              <li class='themed_bg themed-dark-hover-background'><%= link_to "#{t('notification_status')}" ,{:action=>'notification_status'}, :class=>"submit_button" %></li>  
          </ul>
      </div>
    <% end %>
</div>
<div id="page-yield">
    <div class="bread_crumb">
        <%= make_breadcrumb %>
        <%= render_breadcrumbs  %>
    </div>
    <div id='save_msg' class="save_msg"></div>
    <div id='lock_msg' class="lock_msg"></div>
    <div class="label-field-pair notification-status">
        <label><%= t('select_a_batch') %></label>
        <div class="text-input-bg">
            <% if @config.config_value == 'Daily' %>
              <%= select :batch, :id,
                @batches.map {|b| [b.full_name, b.id] },
                {:prompt => "#{t('select_a_batch')}"},
                {:onchange => "getjson(value);"} %>
            <% else  %>
              <%= select :batch, :id,
                @batches.map {|b| [b.full_name, b.id] },
                {:prompt => "#{t('select_a_batch')}"},
                {:onchange => "#{remote_function(
                :url => { :action => 'list_subject' },
                :with => "'batch_id='+value",
                :before => "Element.show('loader')",
                :success => "Element.hide('loader')"  )}"} %>
            <% end %>
        </div>
        <%= image_tag("loader.gif", :align => "absmiddle", :border => 0, :id => "loader", :style =>"display: none;margin-top: 10px;" ) %>
    </div>
    <%= hidden_field_tag 'time_zone_date',@date_today, :id=>'time_zone' %>

    <div id="subjects"></div>
    <div id="error_messages"></div>
    <div id="register"></div>
    <div id="pdf_csv_section" class="pdf_csv_section" style="display:none;">
        <%= link_to "►#{t('pdf_report')}", '#', :onclick => "register_pdf();" ,:class=>'pdf_user_button'  %>
        <%= link_to "►#{t('csv_report')}",'#', :onclick => "register_csv();", :class => 'csv_user_button button_align'%>
    </div>
    <div id="modal-box" style="display:none;"></div>
</div>
<% if @delayed_sms_enabled %>
  <div id="delay_sms_true" style="display: none"></div>
<% end %>

<script type="text/javascript">
  var delay_check_val = false;
<%= "delay_check_val = true;" if @delayed_sms_enabled %>

  var interval = setInterval(function () {
      if (j('#delay_sms_true').length) {
          j('#delay_quick_attendance').show();
      } else {
          j('#delay_quick_attendance').hide();
          j('#delay-quick-attendance-check').prop('checked', false);
      }
  }, 3)

  function check_type(obj) {
      let selectElementText = obj
      if (selectElementText.selectedIndex == 2)
      {
          j('#half_day').hide();
      } else {
          j('#half_day').show();
      }
  }
  function register_pdf() {
      var next = j('#datepicker').val();
      var enable_roll_number = <%= Configuration.enabled_roll_number? %>
      if (enable_roll_number) {
          var sort_by = j('input[name=sort_order_selector]:checked', '#sort_form').val();
      } else {
          var sort_by = 0;
      }
      batch_id = j('#batch_id').val()
      var config_value = "<%= @config.config_value  %>"
      if (config_value == "Daily") {
          if (navigator.userAgent.indexOf("Firefox") == -1) {
              window.open('/attendances/attendance_register_pdf?target=_blank&batch_id=' + batch_id + '&sort_by=' + sort_by + '&next=' + next + '&report_format_type=pdf&page_height=750', '_blank');
          } else {
              document.location = '/attendances/attendance_register_pdf?batch_id=' + batch_id + '&sort_by=' + sort_by + '&next=' + next + '&report_format_type=pdf&page_height=750'
          }

      } else {
          subject_id = j('#subject_id option:selected').val();
          if (navigator.userAgent.indexOf("Firefox") == -1) {
              window.open('/attendances/attendance_register_pdf?target=_blank&batch_id=' + batch_id + '&sort_by=' + sort_by + '&next=' + next + '&subject_id=' + subject_id + '&report_format_type=pdf&page_height=750', '_blank');
          } else {
              document.location = '/attendances/attendance_register_pdf?batch_id=' + batch_id + '&sort_by=' + sort_by + '&next=' + next + '&subject_id=' + subject_id + '&report_format_type=pdf&page_height=750'
          }
      }
      return false;
  }

  function register_csv() {
      var next = j('#datepicker').val();
      var enable_roll_number = <%= Configuration.enabled_roll_number? %>
      if (enable_roll_number) {
          var sort_by = j('input[name=sort_order_selector]:checked', '#sort_form').val();
      } else {
          var sort_by = 0;
      }
      var config_value = "<%= @config.config_value  %>"
      batch_id = j('#batch_id').val()
      if (config_value == "Daily") {
          document.location = '/csv_export/generate_csv?batch_id=' + batch_id + '&sort_by=' + sort_by + '&next=' + next + '&report_format_type=csv&csv_report_type=attendance_register_csv';
      } else {
          subject_id = j('#subject_id option:selected').val();
          document.location = '/csv_export/generate_csv?batch_id=' + batch_id + '&sort_by=' + sort_by + '&next=' + next + '&subject_id=' + subject_id + '&report_format_type=csv&csv_report_type=attendance_register_csv';
      }
      return false;

  }






</script> 
