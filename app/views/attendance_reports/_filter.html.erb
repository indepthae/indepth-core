<%-# Fedena
#Copyright 2010 Foradian Technologies Private Limited
#
#This product includes software developed at
#Project Fedena - http://www.projectfedena.org/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>
<div id="filter_page">
    <div class="filter_report">
        <div class="day_count">
            <%  if @config == 'Daily' %>
              <%= "#{t('total_no_of_wrkng_days')} = #{@academic_days_count}" %>
              <br/>
            <% else %>
              <% unless params[:filter][:subject] == '0' %>
                <%= "#{t('total_no_of_wrkng_hours')}= #{@academic_days_count}" %>
              <% end  %>
            <% end  %>
        </div>
        <div class="filter_range"><%= t('filtered') %>: <%=  t(@range.downcase) %> <%= @value %><%= '%' %></div>
    </div>
    <% unless @leaves.present? %>
      <p class="flash-msg"><%= t('no_reports') %></p>
    <% else %>
      <div id="report_section">
          <div class="outer">
              <div class="inner">
                  <table id="report_result" align="center" width="100%">
                      <tr class="tr-head">
                          <td class="sl_no fixed-header"><%= t('s_n') %></td>
                          <td class="student_name fixed-header"><%= t('name') %></td>
                          <td class="adm_no fixed-header"><%= t('adm_no') %></td>
                          <% if @selected_columns.present? %>
                            <% @selected_columns.each do | column| %>
                              <td class="<%= column %>"><%= t(column) %></td> 
                            <% end %>
                          <%end%>
                          <% if  @config_enable == "1" %>
                            <td class="attendance_count"><%= t('present') %></td>
                            <td class="attendance_count"><%= t('late') %></td>
                            <td class="attendance_count"><%= t('absent') %></td>
                          <% end %>
                          <td class="total_no"><%= t('total') %></td>
                          <td class="per_no"><%= t('percentage') %>(%)</td>
                      </tr>
                      <% i = 0 %>
                      <% @leaves.each_pair do |student_id, data| %>
                        <% student = @students.select {|x| x.id == student_id}.last %>            
                        <tr class="tr-<%= cycle('odd', 'even') %>">
                            <% @flag=0 %>
                            <% i = i.next %>
                            <td class="sl_no"> <%= i %></td>
                            <td class="student_name"><%= link_to student.full_name, {:controller => "attendance_reports", :action => "student_details", :id => student.id,:subject_id=>params[:filter][:subject],:start_date=>@start_date,:end_date=>@end_date } %></td>
                            <td class=""> <%= student.admission_no %></td>
                            <% if @selected_columns.present? %>
                              <% @selected_columns.each do | column| %>
                                <td class=""><%=  student.send(column.to_sym).present? ?  student.send(column.to_sym) : "-" %></td> 
                              <% end %>
                            <% end %>
                            <% if  @config_enable == "1" %> 
                              <td class="attendance_count"><%=  @present[student.id]['present'].present? ? @present[student.id]['present'] : "0" %></td>
                              <td class="attendance_count"><%= @late[student.id].present? ? @late[student.id].count : '0' %></td>
                              <td class="attendance_count"><%= @absent[student.id]['leave'].present? ? @absent[student.id]['leave'] : "0"  %></td>
                            <% end %>
                            <td class="total_no"> <%= data['total_academic_days'] == 0 ? '-' : "#{data['total']} / #{data['total_academic_days']}" %> </td>                   
                            <td class="per_no"> <%= data['percent']  %></td>
                        </tr>
                      <% end %>
                  </table>
              </div>
          </div>
      </div>
    <% end %>
    <% if @flag==0 %>
      <% unless @subject.nil? %>
        <%subject_id=@subject.id %>
      <% else %>
        <%subject_id = '0'%>
      <% end %>
      <div id = "button">
          <% if   @selected_columns.present?  and  @selected_columns.count > 2 %>
            <span id ="pdf_tooltip" tooltip = "<%= t('selected_columns') %>" onclick ="return false">  <%= link_to "►#{t('pdf_report')}", {:controller=>'attendance_reports', :action=> 'filter_report_pdf',:page_height=>750,:batch=> @batch.id,:report_format_type => "pdf" ,:selected_columns => @selected_columns ,:start_date=> @start_date ,:end_date => @end_date ,:report_type=> @mode,:subject=> params[:subject_id]} ,{:target => '_blank',:class=>'pdf_user_button disabled' } %></span>
          <% else %>
            <%= link_to "►#{t('pdf_report')}", {:controller=>'attendance_reports', :action=> 'filter_report_pdf',:batch=> @batch.id,:start_date=> @start_date ,:end_date => @end_date,  :selected_columns => @selected_columns,:report_format_type => "pdf",:report_type=> @mode,:subject=> subject_id,:range=>params[:filter][:range],:value=>params[:filter][:value]} ,{:target => '_blank',:class=>'pdf_user_button' } %>
          <% end %>
          <%= link_to "►#{t('csv_report')}", {:controller => 'csv_export', :action => 'generate_csv', :csv_report_type => 'student_attendance_report',:report_format_type => "csv", :batch => @batch.id, :start_date => @start_date, :end_date => @end_date, :report_type => @mode, :selected_columns => @selected_columns ,:subject => subject_id, :range => params[:filter][:range], :value => params[:filter][:value]}, :class => 'csv_user_button button_align'%>
      </div>

    <% end %>
    <div class="extender"></div>
</div>

