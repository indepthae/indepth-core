<%-# Fedena
#Copyright 2018 Foradian Technologies Private Limited
#
#This product includes software developed at
#Project Fedena - http://www.projectfedena.org/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>

<div id="content-header">
    <%= show_header_icon %>
    <h1><%= t('gradebook') %></h1>
    <div class='header-sep'>|</div>
    <div class='sub-header'><%= t('gradebook_attendance') %></div>
</div>
<div id="page-yield">
    <div class="bread_crumb">
        <%= breadcrumb :gradebook_attendance_period, [@course,@academic_year] %>
        <%= render_breadcrumbs  %>
    </div>
    <div class="details">
        <div class="left">
            <div class="clm">
                <div class="label"><%="#{t('course_text')}"%></div>
                <div class="value"><%=@course.full_name%></div>
            </div>
            <div class="clm">
                <div class="label"><%=t('academic_year')%></div>
                <div class="value"><%=@academic_year.name%></div>
            </div>
            <div class="clm">
                <div class="label"><%=t('batches_text')%></div>
                <div class="value"><%=@course.batches_in_academic_year(@academic_year.id).count%></div>
            </div>
        </div>
    </div>
    <div id="flash"></div>
    <div class="gradebook_attendance_form">
        <% remote_form_for :exam_dates ,:url=>{:action=>'save_exam_dates'}  do |f| %>
          <div class="selectors">
              <div id="select_exam" class="selector">
                  <div class="label-field-pair">
                      <div class="label">
                          <label for="gradebook_attendance_linkable_id" class="label-batch"><%= t('exam_text') %></label>
                      </div>
                      <span>
                          <%= f.select :assessment_group_id, grouped_options_for_select(@list),
                            {:include_blank=>t('select_exam')},
                            {:onChange => "#{remote_function(:url => {:action => "load_batches"},
                            :with => "'exam_id='+value+'&course_id='+#{@course.id}")}"}
                        %>
                      </span>
                  </div>
              </div>
              <div id ="exam_dates" class="exam_dates">
                  <%= render :partial=>'date_selectors' %>
              </div>
              <div id="submit_btn" class="submit_btn"></div>
          </div>
          <div id="batches"></div>
          <hr/>
        <% end %>
    </div>
    <div id="attendance_period">

    </div>
</div>

<script type="text/javascript">
  var msg = '<% t('start_date_cant_be_after_end_date') %>';
  var err = 0;
  showBatches = function () {
      j('#each_batches').show();
      j('#all_batches').hide();
      j('#all_batches input').attr('disabled', true);
      j('#each_batches input').attr('disabled', false);
      j('.check_batch').prop('checked', true);
  };
  hideBatches = function () {
      j('#each_batches').hide();
      j('#all_batches').show();
      j('#all_batches input').attr('disabled', false);
      j('#each_batches input').attr('disabled', true);
      j('.check_batch').prop('checked', false);
  };
  function validateDateRange() {
      if (j('#start_date').val() !== "" & j('#end_date').val() !== "")
      {
          if (j('#start_date').val() > j('#end_date').val())
          {
              j('.calendar_label').addClass("error-field");
              icon = j('<div></div', {'class': 'error-icon'});
              icon.attr('tooltip', msg);
              j('.calendar_label').parent().append(icon);
              err++;
          } else {
              j('.calendar_label').removeClass("error-field");
              j('.calendar_label').siblings('.error-icon').remove();
              err--;
          }
          submit_check();
      }
  }
  ;
  submit_check = function () {
      if (err > 0)
          j('.submit-button').attr('disabled', 'disabled');
      else
          j('.submit-button').removeAttr('disabled');
  };
  function select_all() {
      if (j('.check_all').prop('checked')) {
          j('.check_batch').prop('checked', true);
      } else {
          j('.check_batch').prop('checked', false);
      }
  }
  function check_batch() {
      j('.check_all').prop('checked', j('.check_batch:checked').length === j('.check_batch').length);
  }
</script>