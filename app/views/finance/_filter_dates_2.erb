<% additional_params ||= {} %>
<% form_remote_for :report, :url => {:action => @target_action || "update_monthly_report",
                              :id => @fee_collection || params[:id], :date_tag => params[:date_tag],
                              :batch_id => params[:batch_id]}.merge(additional_params.except(:fee_account_id)),
            :html => {:id => "form_id"} do |form| %>

    <div class="float-box width50p">
      <div class="fields-label">
        <%= t('select_a_date_range') %>
      </div>
      <div class="fields">
        <div class="date">
          <%= calendar_date_select_tag 'start_date', I18n.l(@start_date.try(:to_date) || Date.today,
                                                            :format => :default), :popup => :force %>
        </div>

        <div class="date end_date">
          <label><%= t('to') %></label>
          <%= calendar_date_select_tag 'end_date', I18n.l(@end_date.try(:to_date) || Date.today,
                                                          :format => :default), :popup => :force %>
        </div>

        <div id="date_error_div">
          <% unless flash[:warn_notice].nil? %>
              <%= render :partial => "date_error" %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="float-box width50p">
      <div class="fields-label">
        <% if @accounts_enabled %>
            <%= t('fee_account_text') %>
        <% end %>
      </div>
      <div class="fields">
        <% if @accounts_enabled %>
            <div class="text-input-bg accounts_list">
              <% selected = @account_id.present? ? @account_id : nil %>
              <%= select_tag :fee_account_id, options_for_select(@accounts.map { |a| [a.name, a.id] }.
                                                                         unshift([t("default_account"), 0]).unshift([t("all_accounts"), nil]), :selected => selected) %>
            </div>
        <% end %>

        <div class="view_report">
          <%= submit_tag "#{t('view_report')}", {:class => 'user_button1'} %>
          <% if @target_action.present? %>
              <span class="themed_hover_text" id="hide_date_filter"><%= t('cancel') %></span>
          <% end %>
        </div>
      </div>
    </div>
<% end %>

<script type="text/javascript">

    j('.calendar_label').on('click', function () {
        var month_names = "<%= I18n.t('date.month_names').compact.join(',') %>";
        new CalendarDateSelect(this.previous(), {
            date_format: "<%= date_format %>",
            locale_months: month_names,
            popup: 'force', year_range: 10
        });
    });

    j("#hide_date_filter").click(function () {
        j(".date_box").hide();
        j("#show_date").show();
    });

    j("#show_date").click(function () {
        j(".date_box").show();
        j("#show_date").hide();
    });

</script>