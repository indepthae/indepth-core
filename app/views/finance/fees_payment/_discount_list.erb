<% unless @total_discount == 0 %>
  <tr class="row-a">
      <td class="sl-col col-1"></td>
      <td class="col-1 bold_font" colspan="3">
          <span><%= t('discount') %></span>
      </td>
  </tr>
<% end %>
<div id="discounts-list">
    <% student_discount_link=false %>
    <% @categorized_discounts.each do |discount_type| %>      
      <tr class="row-a <%= discount_type.first %>head" cellpadding="1" cellspacing="1">
          <td class="sl-col"></td>
          <td class="set_border_right bold_font" colspan="3">
              <span><%= "#{t(discount_type.first.underscore+"_text").titleize}-#{t('wise')}" %></span>
          </td>
      </tr>
      <% discount_type.last.each do |fee| %>
        <% discount_text = fee.is_amount == true ? "#{fee.name}" : "#{fee.name}-#{fee.discount}% " %>

        <tr class="row-b particular" id="particular<%= fee.id %>">
            <td class="sl-col normal_font particular_index"><%= i+=1 %></td>

            <% if fee.master_receiver_type=='FinanceFeeParticular' %>
              <% particular=fee.master_receiver %>
              <td class="set_border_right particular-col normal_font">
                  <%= "#{discount_text}  &#x200E;(#{particular.name}) &#x200E;" %>
              </td>
              <td class="set_border_right amount-col normal_font align_right"> 
                  <%= precision_label(particular.amount * fee.discount.to_f/ (fee.is_amount? ? particular.amount : 100)) %>
              </td>
            <% else %>
              <td class="set_border_right particular-col normal_font">
                  <%= discount_text %>
              </td>
              <td class="set_border_right amount-col normal_font align_right">
                  <%= precision_label(@total_payable * fee.discount.to_f/ (fee.is_amount? ? @total_payable : 100)) %>
              </td>
            <% end %>

            <td class="cancel-disc cancel-color">
                <% if can_access_request? :delete_student_discount, :finance_extensions %>
                  <% if !@prevent_instant.present? and !fee.multi_fee_discount.present? and discount_type.first=='Student' and 
                      fee.is_instant and (@financefee.balance.to_f > 0 ) and @student.class.name == 'Student'%>
                    <% unless fee.finance_transaction_id.present?%>
                    <div class="particular-or-discount-deletion" id="<%= fee.id %>" 
                         finance_id="<%= @financefee.id %>" 
                         render_action="<%= @target_action %>" 
                         render_controller="<%= @target_controller %>" 
                         target_action="delete_student_discount">
                             <%= ("&times") %>
                    </div>
                  <% end %>
                  <% end %>
                <% end %>
            </td>
        </tr>
      <% end %>
  </div>
  <% balane = @financefee.tax_enabled ? (@financefee.balance.to_f - @financefee.tax_amount.to_f) : @financefee.balance.to_f %>
  <% unless @payer_type.present? and @payer_type=="Archived Student"%>
    <% if !@prevent_instant.present? and discount_type.first=='Student' and (balane.to_f > 0) %>
      <% student_discount_link=true %>
      <tr class="row-a">
          <td colspan="3">
              <% unless @particular_wise_paid %>
                <div class="instant-particular">
                  <% cat_id = @financefee.finance_fee_collection.fee_category_id %>
                  <% #unless FeeDiscount.has_unlinked_discounts?(cat_id) %>
                      <%= link_to_remote "+ #{t('add_discount')}",
                                         :url => {:controller => "finance_extensions",
                                                  :action => "new_instant_discount", :id => @financefee.id,
                                                  :current_action => @target_action,
                                                  :current_controller => @target_controller} %>
                  <% #else %>
                      <% #= link_to "#{t('link_discount')}", manage_masters_master_fees_path({:fee_type => 'core', :cat_id => cat_id}), :target => "_blank" %>
                  <% #end %>
                </div>
            <% end %>
          </td>
          <td class="cancel-disc"></td>
      </tr>
    <% end %>
  <% end %>
<% end %>
<% balane = @financefee.tax_enabled ? (@financefee.balance.to_f - @financefee.tax_amount.to_f) : @financefee.balance.to_f %>
<% if can_access_request? :new_instant_discount, :finance_extensions %>
  <% unless @payer_type.present? and @payer_type == "Archived Student"%>
    <% if !@prevent_instant.present? and !student_discount_link and (balane.to_f > 0)  %>
      <tr class="row-a">
          <td colspan="3" style="width:100%">
              <% unless @particular_wise_paid %>
                <div class="instant-particular">
                  <% cat_id = @financefee.finance_fee_collection.fee_category_id %>
                  <% #unless FeeDiscount.has_unlinked_discounts?(cat_id) %>
                      <%= link_to_remote "+ #{t('add_discount')}",
                                         :url => {:controller => "finance_extensions",
                                                  :action => "new_instant_discount", :id => @financefee.id,
                                                  :current_action => @target_action,
                                                  :current_controller => @target_controller} %>
                  <% #else %>
                      <% #= link_to "#{t('link_discount')}", manage_masters_master_fees_path({:fee_type => 'core', :cat_id => cat_id}), :target => "_blank" %>
                  <% #end %>
                </div>
              <% end %>
          </td>
          <td class="cancel-disc"></td>
      </tr>
    <% end %>
  <% end %>
<% end %>