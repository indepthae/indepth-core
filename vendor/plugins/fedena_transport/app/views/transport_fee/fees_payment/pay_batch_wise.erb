<%-# Fedena
#Copyright 2010 Foradian Technologies Private Limited
#
#This product includes software developed at
#Project Fedena - http://www.projectfedena.org/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>
<%= javascript_include_tag("receipt_printer") %>
<%= javascript_include_tag("fine_updations_for_transport") %>
<% if rtl? %>
  <%= stylesheet_link_tag "rtl/gray_table_design" %>
  <%= stylesheet_link_tag "rtl/finance/_payment_form" %>
  <%= stylesheet_link_tag "rtl/finance/_collection_layouts" %>
<% else %>
  <%= stylesheet_link_tag "gray_table_design" %>
  <%= stylesheet_link_tag "finance/_payment_form" %>
  <%= stylesheet_link_tag "finance/_collection_layouts" %>
<% end %>

<div id="content-header">
    <%= show_header_icon %>
    <h1><%= "#{t('transport_text')}"%></h1>
    <div class='header-sep'>|</div>
    <div class='sub-header'><%= "#{t('pay_fees')}"%></div>
    <div id="inner-tab-menu">
        <ul>
            <li class='themed_bg themed-dark-hover-background'>
                <%= link_to "#{t('defaulters')}", :controller => "transport_fee", 
                  :action => "transport_fee_defaulters_view" %>
            </li>
        </ul>
    </div>
</div>

<div id="page-yield">
    <div class="bread_crumb">
        <%= make_breadcrumb %>
        <%= render_breadcrumbs  %>
    </div>

    <div id="batchs1">
        <div class="details">
            <% form_for :fees_submission_batch do %>
              <div class="each-detail" id="hide1">
                  <label class="name"><%= t('batch') %></label>
                  <div class="val">
                      <div class="text-input-bg val-align"> 
                          <%= select :fees_submission, :batch_id, @batches.map {|c| 
                            [c.full_name, c.id] },
                            {:prompt => "#{t('select_a_batch')}"},
                            {:onChange => "#{remote_function(:url => 
                            {:action => "update_fee_collection_dates"}, 
                            :with => "'batch_id='+value",
                            :before => "Element.show('loader')",
                            :success => "Element.hide('loader')",
                            :complete=>"show_fee_details();")}"
                          }%>
                      </div>
                  </div>

                  <div class="loader_div">
                      <%= image_tag("loader.gif", :align => "absmiddle",:border => 0, 
                        :id => "loader",:style =>"display: none; " ) %>
                  </div>
              </div>

              <div class="each-detail">
                  <label class="name"><%= t('fee_collection') %></label>
                  <div class="val">
                      <div class="text-input-bg val-align">
                          <div id="fees_collection_dates">
                              <%= render :partial => "transport_fee_collection_dates"  %>
                          </div>
                      </div>
                  </div>
                  <div class="loader_div">
                      <%= image_tag("loader.gif",
                        :align => "absmiddle",
                        :border => 0,
                        :id => "collection_loader",
                        :style =>"display: none; " ) %>
                  </div>
              </div>
            <% end %>            
        </div>
        
        <div id="fees_detail"></div>

        <div id="modal-box" style="display:none;"></div>

    </div>
    <div class="extender"></div>
</div>

<script type="text/javascript">

  function validate_payment_mode() {
      if ($('fees_payment_mode') != null) {
          if ($('fees_payment_mode').select('input')[0].value == "") {
              alert('<%= "#{t('select_one_payment_mode')}"%>');
              return false;
          } else {
              return true;
          }
      } else {
          return true;
      }
  }
  
  function fetch_max_transport_discount(f_id) {
      j("#waiver_loader").show();
      j("#submit_button_discount").attr("disabled", true);
      j('#discount_amount').removeClass('width-50')
      j('.post-symbol').text('<%=currency %>')
      j('#discount_amount').addClass('width-130')
      j('#all_students').html()
      j.ajax({
          type: 'GET',
          url: "/transport_fee/fetch_waiver_amount_transport_fee",
          data: {
            id: f_id,
            student_id: j("#student_id").val(),
            collection: j("#transportfee_id").val()
          },
          success: function (data) {
            j("#waiver_loader").hide();
            j("#submit_button_discount").attr("disabled", false);
            j('#discount_amount').val(data.attributes);
          }
        });
    }

</script>
