<%= javascript_include_tag("receipt_printer") %>
<%= javascript_include_tag("fine_updations_for_transport") %>
<% if rtl? %>
  <%= stylesheet_link_tag "rtl/gray_table_design" %>
  <%= stylesheet_link_tag "rtl/finance/_payment_form" %>
  <%= stylesheet_link_tag "rtl/finance/_collection_layouts" %>
<% else %>
  <%= stylesheet_link_tag "gray_table_design" %>
  <%= stylesheet_link_tag "finance/_payment_form" %>
  <%= stylesheet_link_tag "finance/_collection_layouts" %>
<% end %>

<div id="content-header">
    <%= show_header_icon %>
    <h1><%= t('transport_fee.transport_fee_submission') %></h1>
    <div class='header-sep'>|</div>
    <div class='sub-header'><%= @student.full_name %></div>
</div>

<div id="page-yield">
    <div class="bread_crumb">
        <% breadcrumb :transport_fee_fees_student_dates, @student %>
        <%= render_breadcrumbs  %>
    </div>

    <div id="flash-msg"></div>

    <% if @transport_fee_collection.nil? %>
      <div id="batchs1">
          <div class="details">
              <div class="each-detail" id="hide1">
                  <label class="name"><%= t('select_fee_collection_date') %></label>
                  <div class="val">
                      <div class="text-input-bg val-align"> 
                          <div class="text-input-bg">
                              <%= select  :fees_submission, :dates_id, @dates.map { |e| [e.name, e.id]},
                                {:prompt => "#{t('select_fee_collection_date')}"},
                                {:onChange => "#{remote_function( :url =>
                                {:action => "fees_submission_student"},
                                :with => "'date='+value+'&student='+#{@student.id}",
                                :before => "Element.show('loader')",
                                :success => "Element.hide('loader')")}"} %>
                          </div>
                      </div>

                      <div class="loader_div">
                          <%= image_tag("loader.gif", :align => "absmiddle",:border => 0, 
                            :id => "loader",:style =>"display: none; " ) %>
                      </div>
                  </div>
              </div>
          </div>
      </div>
    <% else %>
      <script type="text/javascript">
  <%= remote_function(:url => { :action => 'fees_submission_student' }, 
    :with => "'date='+'#{@transport_fee_collection.id}'+'&student='+'#{@student.id}'+'&payment_date='+'#{@payment_date}'+'&payer_type='+'#{@payer_type}'") %>
      </script>
    <% end %>
      <div id="fees_detail">
        <div id= "fee_submission"></div>
        <div id="fees_details"></div>
      </div>
</div>

<div id="modal-box" style="display:none;"></div>

<script type ="text/javascript">

  function validate() {
      if (isNaN($('fine_fee').value) == false) {
          if ($('fine_fee') < 0) {
              $('fine_fee').value = 0;
              alert('<%= "#{t('enter_positive_fine_value')}"%>');
              return false;
          } else {
              new Ajax.Request('/transport_fee/update_student_fine_ajax', {
                  asynchronous: true, evalScripts: true,
                  parameters: Form.serialize($('fine_form'))});
              return false;
          }
      } else {
          $('fine_fee').value = 0;
          alert('<%= "#{t('enter_numeric_fine_value')}" %>');
          return false;
      }
  }

  function validate_payment_mode() {
      if ($('fees_payment_mode') != null) {
          if ($('fees_payment_mode').select('input')[0].value == "") {
              alert('<%= "#{t('select_one_payment_mode')}"%>');
              return false;
          } else {
              return true;
          }
      } else {
          return true;
      }
  }
  
  function fetch_max_transport_discount(f_id) {
      j("#waiver_loader").show();
      j("#submit_button_discount").attr("disabled", true);
      j('#discount_amount').removeClass('width-50')
      j('.post-symbol').text('<%=currency %>')
      j('#discount_amount').addClass('width-130')
      j('#all_students').html()
      j.ajax({
          type: 'GET',
          url: "/transport_fee/fetch_waiver_amount_transport_fee",
          data: {
            id: f_id,
            student_id: j("#student_id").val(),
            collection: j("#transportfee_id").val()
          },
          success: function (data) {
            j("#waiver_loader").hide();
            j("#submit_button_discount").attr("disabled", false);
            j('#discount_amount').val(data.attributes);
          }
        });
    }
  
</script>
