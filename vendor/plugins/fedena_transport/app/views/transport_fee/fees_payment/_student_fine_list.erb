<% total_paid_fine = 0 %>
<% ft_fine_amount = 0 %>

<% head_row = 0 %>
<% if @transport_fee.finance_transactions_with_fine.present? %>
  <% head_row = 1 %>
  <tr class="row-a">
      <td class="sl-col col-1"></td>
      <td class="bold_font" colspan="3">
          <span><%= t('fine') %></span>
      </td>
  </tr>
<% end %>

<% @transport_fee.finance_transactions_with_fine.each do |ft|%>
  <% ft_fine_amount += ft.fine_amount %>
  <tr class="row-b fine-row">
      <td class="sl-col"><%= i+=1 %></td>
      <td class="set_border_right particular-col">
          <%= "#{t('fine_on')} #{format_date(ft.transaction_date)}" %>
      </td>
      <td class="set_border_right amount-col normal_font align_right">
          <%= precision_label ft.fine_amount %>
      </td>
      <td class="cancel-disc cancel-color"></td>
  </tr>
<% end %>

<% unless ft_fine_amount == 0 %>
  <% @total_paid_fine += (precision_label ft_fine_amount).to_f %>
<% end %>

<% unless @transport_fee.finance_transactions_with_fine.present? %>
  <% unless @transport_fee.is_paid %>
    <% if @fine_rule.present? %>
      <% @total_paid_fine += (precision_label @fine_amount).to_f %>
      <% head_row = 1 %>
      <tr class="row-a">
          <td class="sl-col col-1"></td>
          <td class="bold_font" colspan="3">
              <span><%= t('fine') %></span>
          </td>
      </tr>

      <tr class="row-b fine-row" id="auto_fine_cancel">
          <td class="sl-col"><%= i+=1 %></td>
          <td class="set_border_right particular-col">
              <span>
                  <%= t('fine_on') %>
                  <%= "#{format_date(@date.due_date.to_date + @fine_rule.fine_days.days)}
      #{@fine_rule.is_amount ? "" : " (#{@fine_rule.fine_amount}&#x200E;%)" }"  %>
              </span>
          </td>
          <td class="set_border_right amount-col normal_font align_right" id="auto_fine_amount">
              <%= precision_label(@fine_amount) %>
          </td>
          <td class="cancel-disc cancel-color">
            <%if !@fine_detail_flag.present? && (@current_user.admin? or @current_user.privileges.map(&:name).include? "TransportAdmin")%>
              <div class="auto-cancel-fine link-icon"></div>
            <%end%>
          </td>
      </tr>

    <% end %>
  <% end %>

<% else %>

  <% unless @transport_fee.is_paid %>
    <% if @fine_rule.present? and @fine_amount > 0 %>
      <% @total_paid_fine += (precision_label @fine_amount).to_f %>

      <tr class="row-b fine-row" id="auto_fine_cancel">
          <td class="sl-col"><%= i+=1 %></td>
          <td class="set_border_right particular-col">
              <span>
                  <%= t('fine_on') %>
                  <%= "#{format_date(@date.due_date.to_date + @fine_rule.fine_days.days)}
      #{@fine_rule.is_amount ? "" : " (#{@fine_rule.fine_amount}&#x200E;%)" }"  %>
              </span>
          </td>
          <td class="set_border_right amount-col normal_font align_right" id="auto_fine_amount">
              <%= precision_label @fine_amount%>
          </td>
          <td class="cancel-disc cancel-color">
            <%if !@fine_detail_flag.present? && (@current_user.admin? or @current_user.privileges.map(&:name).include? "TransportAdmin")%>
              <div class="auto-cancel-fine link-icon"></div>
            <%end%>
          </td>
      </tr>
    <% end %>
  <% end %>
<% end %>

<% if head_row == 0 %>
  <tr class="row-a" id="head-show-fine">
      <td class="sl-col col-1"></td>
      <td class="bold_font" colspan="3">
          <span><%= t('fine') %></span>
      </td>
  </tr>
<% end %>
