<% content_for :head do %>
  <link rel="stylesheet" type="text/css" href="<%= "#{Rails.root}/vendor/plugins/gradebook_templates/template_h/templates/stylesheets/template_h_style.css" %>">
<% end %>

<div id="page-yield" class="available_sections">
    <div class="section">
        <%= report_header({:school_name=> report.school_details.name, :school_address=> report.school_details.address,
            :logo1_url=> load_asset_path(settings[:template_h_logo]),:logo2_url => default_school_logo,
            :school_email_with_website=> report.school_details.email_with_website }) %>
    </div>

    <div class="section">
        <%= report_name(settings[:template_h_header]) %>
    </div>

    <!-- Student Details Section -->
    <% student_details_count = report.student.details.count %>
    <% no_of_rows = (student_details_count.odd? ? ((student_details_count+1)/2) : (student_details_count/2))  %>
    <% row = 0 %>
    <div class="section">
        <table class="primary borderless">
            <colgroup class="field_table">
                <col>
                <col>
            </colgroup>  
            <colgroup class="field_table">
                <col>
                <col>
            </colgroup> 
            <% ind = 0 %>
            <%  no_of_rows.times do %>
              <% row += 1 %>
              <% col = 1 %>
              <tr>
                  <% report.student.details.to_a.each_with_index do |st_detail, index| %>
                    <%  break if col == 3 %>
                    <% next if index < ind %>
                    <% col += 1 %>
                    <td colspan="1" class="bold text-left"><%= st_detail[0] %></td>
                    <td class="left_text"><%= st_detail[1] %></td>
                    <% ind += 1 %>
                  <% end %>
              </tr>
            <% end %>
        </table>
    </div>
    <!-- Student Details Section -->

    <% grouped_activity_sets = report.activity_sets.group_by{|r| r.profile_name } %>
    <div class="section margin_top_0">
        <% if grouped_activity_sets.present? %>
          <% keys = grouped_activity_sets.keys %>
          <% length = keys.length %>
          <% if length == 1 %>
            <% left_keys = keys %>
            <% right_keys = [] %>
          <% elsif length == 2 %>
            <% left_keys = [keys.first] %>
            <% right_keys = [keys.last] %>
          <% else %>
            <%if length.odd?%>
              <%len =length/2 %>            
            <%else%>
              <%len =(length/2)-1 %>            
            <%end%>
            <% left_keys = keys[0..((len))] %>
            <% right_keys = keys[((len)+1)..(length-1)] %>
          <% end %>
          <% if keys.present? %>
            <div class="<%= group_report? ? 'twelve' : 'six' %> columns">
                <% left_keys.each do |key| %>
                  <%=render :file=> "#{Rails.root}/vendor/plugins/gradebook_templates/template_h/templates/_grouped_activity_sets.erb", :locals => {:key => key, :activity_sets => grouped_activity_sets[key]}%>  
                <%end%>
                <% if length.odd? %>
                  <%= report_remarks(report.remarks)  %>
                <% else %>
                  <% if report.attendance_reports.present? %>
                    <table class="primary striped condensed">
                        <%= attedance_report(:type => 'term_and_consolidated') %> 
                    </table>    
                  <% end %>
                <% end %>
            </div>
            <div class="six columns">
                <% right_keys.each do |key| %>
                  <%=render :file=> "#{Rails.root}/vendor/plugins/gradebook_templates/template_h/templates/_grouped_activity_sets.erb", :locals => {:key => key, :activity_sets => grouped_activity_sets[key]}%>  
                <%end%>
                <% if length.odd? %>
                  <% if report.attendance_reports.present? %>
                    <table class="primary striped condensed">
                        <%= attedance_report(:type => 'term_and_consolidated') %> 
                    </table>    
                  <% end %>
                <% else %>
                  <%= report_remarks(report.remarks)  %>
                <% end %>
            </div>
          <% end %>
        <%end%>
    </div>

    <% if report.student.records.present? %>
      <div class="section ">
          <%= gradebook_records(report) %>
      </div>
    <% end %>

    <div class="section margin_top_0">
        <% if report.exam_attendance_reports.present? %>
          <table class="primary striped condensed">
              <%= attedance_report(:type => 'full') %> 
          </table> 
        <% end %>
    </div>


    <div class="section margin_top_0">
        <% report.grade_scales.each do |grade_scale| %>
          <div class="six columns">
              <table class="primary striped condensed">
                  <thead>
                  <th colspan="<%= grade_scale.scale.count+1 %>" ><%= grade_scale.name %></th>
                  </thead>
                  <% grade_scale.labels.each_with_index do |label_name, label_index| %>
                    <tr>
                        <td><%=label_name%></td>
                        <% grade_scale.scale.each do |values| %>
                          <td> <%= values[label_index] %> </td>
                        <%end%>
                    </tr> 
                  <%end%>
              </table>
          </div>
        <%end%>
    </div>

    <%  if settings[:signature] == "0"%>
      <div class="section" style="margin-top: 0px !important;">
          <div>
              <div class="four columns left_text">
                  <span class="bold">
                      <div class="sign_img">
                          <% if settings[:sign_left_img].present? %>
                            <%= wicked_pdf_image_tag settings[:sign_left_img] ,:s3=>true,:style=>:original,:timestamp=>false %>
                          <% end %>
                      </div>
                      <div><%= settings[:sign_left_text] %></div>
                  </span>
              </div>
              <div class="four columns center_text">
                  <span class="bold">
                      <div class="sign_img">
                          <% if settings[:sign_center_img].present?  %>
                            <%= wicked_pdf_image_tag settings[:sign_center_img] ,:s3=>true,:style=>:original,:timestamp=>false %>
                          <% end %>
                      </div>
                      <div><%= settings[:sign_center_text] %></div>
                  </span>
              </div>
              <div class="four columns right_text">
                  <span class="bold">
                      <div class="sign_img">
                          <% if settings[:sign_right_img].present? %>
                            <%= wicked_pdf_image_tag settings[:sign_right_img] ,:s3=>true,:style=>:original,:timestamp=>false %>
                          <% end %>
                      </div>
                      <div><%= settings[:sign_right_text] %></div>
                  </span>
              </div>
          </div>
      </div>
    <% end %>
</div>
