<script type="text/javascript">
  function show_members_if_exists(){
    if($('members').value != ''){
      members = $('members').value;
<%= remote_function(:url => {:action => 'update_member_list'}, :with => "'members='+members" ) %>
    }
  }
  function add_member(member) {
    var member_list = new Array();
    if($('members').value != '')
      member_list = $('members').value.split(',');
    else
      member_list = [];

    var member_exists = false;

    for(i=0; i<member_list.length; i++)
      if(member_list[i] == member)
        member_exists = true;

    if(!member_exists) {
      member_list.push(member);
    }
    $('members').value = member_list.join();
    members = $('members').value;
<%= remote_function(:url => {:action => 'update_member_list'}, :with => "'members='+members" ) %>
  }

  function add_all_member(member) {
    var member_list = new Array();
    if($('members').value != '')
      member_list = $('members').value.split(',');
    else
      member_list = [];

    var new_list = member.split(',');

    for(i=0;i<new_list.length;i++)
    {
      var member_exists = false;
      for(k=0; k<member_list.length; k++)
        if(member_list[k] == new_list[i])
          member_exists = true;
      if(!member_exists) member_list.push(new_list[i]);
    }

    $('members').value = member_list.join();
    members = $('members').value;
<%= remote_function(:url => {:action => 'update_member_list'}, :with => "'members='+members" ) %>
  }


  function remove_member(member) {
    members = $('members').value;
    var member_list = new Array();
    member_list = $('members').value.split(',');

    for(i=0; i<member_list.length; i++)
      if (member_list[i] == member)
    {
      member_list.splice(i,1);
      break;
    }

    $('members').value = member_list.join();
    members = $('members').value;
<%= remote_function(:url => {:action => 'update_member_list'}, :with => "'members='+members" ) %>

  }
</script>

<div id="content-header">
<%= show_header_icon %>
  <h1><%= "#{t('doc_manager_text')}"%></h1>
<div class='header-sep'>|</div>
<div class='sub-header'><%= "#{t('edit_shareable_document')}"%></div>
  <%= javascript_include_tag "document"%>

<div id="inner-tab-menu">
  <ul>
    <li class='themed_bg themed-dark-hover-background'> <%= link_to "#{t('doc_manager_text')}", doc_managers_path %>  </li>
  </ul>
</div>

</div>
<div id="page-yield">
  <div class="bread_crumb">
    <%= make_breadcrumb %>
    <%= render_breadcrumbs  %>
  </div>
  <% unless flash[:notice].nil? %>
    <p class="flash-msg"> <%= flash[:notice] %> </p>
  <% end %>

  <%form_for(@document, :url => {:action => :update,:id => @document, :user_id => params[:user_id]}, :html => {:multipart => true}) do |f| %>
    <%= error_messages_for 'document', :header_message => nil %>
    <%= hidden_field_tag :page,params[:page].present? ? params[:page] : '' %>
    <%= hidden_field_tag :members,@members.present? ? @members : '' %>
    <%= hidden_field_tag :query,@query.present? ? @query : '' %>
    <%= hidden_field_tag :folder_id,@folder_id.present? ? @folder_id : '' %>
    <%= hidden_field_tag :action_text,@action.present? ? @action : '' %>

    <% if @document.folder_id.present? %>
      <div id="create_document_form">
        <div class="span-sub-heading">
          <div id="add">
            <%= render "document_fields", :f=>f %>
          </div>
        </div>
        <%= submit_tag "", :value => "#{t('update')}", :class => "submit_button" %>
      <% else %>
        <div id="create_document_form">
          <div class="fields-wrap">
            <div class="span-sub-heading">

              <div id="fields-wrap2">
                <div id="member-list">

                  <script> <%= "show_members_if_exists();" %></script>
                </div>
              </div>
              <div class="fields-wrap1">
                <div class="themed_text themed_text_doc"><%= t('select_users') %>
                <%= image_tag("loader.gif",
                  :align => "absmiddle",
                  :border => 0,
                  :id => "loader",
                  :style =>"display: none;" ) %> </div>

                <div id="select-employee-department">
                
                  <%= render "select_employee_department" %>
                </div>
                <div class="label-field-to">
                  <div id="to_users">         </div>
                </div>

                <div class="extender"></div>
                <div id="select-student-course">
                  <% @courses = Course.active %>
                  <%=  render "select_student_course" %>
                </div>

                <div class="label-field-to">
                  <div id="to_users2">         </div>
                </div>

                <div class="extender"></div>
              </div>
            </div>
          </div>
          <div class="fields-wrap">
            <div class="span-sub-heading">
              <div class="themed_text themed_text_doc"><%= t('add_documents') %> &#x200E;(<%= t('maxi_size') %>)&#x200E;</div>
            </div>
          </div>
          <div class="fields-wrap">
            <div id="add">
              <%= render "document_fields", :f=>f %>
            </div>
          </div>
        </div>

        <%= submit_tag "", :value => "#{t('update')}", :class => "submit_button" %>
      <% end %>
    <% end %>

  </div>
</div>
